<!DOCTYPE html>
<html>
<head>	
<style>
	body {
		margin: 0px;
	}
	#main {
		font-family: sans-serif;
		margin:	0px;
	}

	#navigation_panel {
		width: 80px;
		float: left;
	}

	#map_frame {
		border: 20px black solid;
		float: left;
		margin: 30px;
		overflow: hidden;
	}

	#zoom_buttons {
		width: 60px;
		margin-left: auto;
		margin-right: auto;
		padding-top: 20px;
		padding-bottom: 20px;		
		clear: both;
	}

	.scroll_buttons {
		width: 30px;
	}

	#up_button {
		margin-left: auto;
		margin-right: auto;
		clear: both;
	}

	#left_button {
		clear: left;
	}

	#right_button {
		float: right;
		clear: right;
	}

	#down_button {
		margin-left: auto;
		margin-right: auto;
		clear: both;
	}

	input[type="button"] {
		width: 30px;
		height: 20px;
		float: left;
	}

	#map_image {
		position: relative;
	}

</style>
<meta charset="UTF-8" />
<title>Stanford Maps</title>
</head>
<body onload="init();">
	<div id="main">
		<div id="map_frame">
			<img id="map_image" src="map-s.gif" alt="Stanford Map" />
		</div>
		<div id="navigation_panel">
			<form id="navigation_buttons">
				<div id="zoom_buttons">
					<input type="button" name="zoom_in" value="+" onclick="zoomIn();"/>
					<input type="button" name="zoom_out" value="-" onclick="zoomOut();"/>
					<p id="empty"></p>
				</div>
				<div class="scroll_buttons" id="up_button"><input  type="button" name="scroll_up" value="^" onclick="moveUp();"/></div>
				<div class="scroll_buttons" id="left_button"><input  type="button" name="scroll_left" value="<" onclick="moveLeft();"/></div>
				<div class="scroll_buttons" id="right_button"><input  type="button" name="scroll_right" value=">" onclick="moveRight();"/></div>
				<div class="scroll_buttons" id="down_button"><input type="button" name="scroll_down" value="v" onclick="moveDown();"/></div>
			</form>
		</div>
	</div>
	
	<script type="text/javascript">	
		// "Global constants"
		// Note: These values must be updated manually to reflect the CSS on the map_frame div.
		var border_width = 20;
		var margin_width = 30;
		// Array of imageObj types, used to store relevant information about all map images.
		var imageArray = [];

		document.ondblclick = recenterMap;
		window.onresize = resizeMapFrame;

		function init() {
			resizeMapFrame();
			var map_image = document.getElementById("map_image");
			map_image.style.left = "0px";
			map_image.style.top = "0px";
			preload();
		}

		function preload() {
			image_s = new Image();
			image_m = new Image();
			image_l = new Image();
			image_xl = new Image();

			image_s.src = "map-s.gif";
			image_m.src = "map-m.gif";
			image_l.src = "map-l.gif";
			image_xl.src = "map-xl.gif";

			imageArray = [image_s, image_m, image_l, image_xl];
		}

		function recenterMap(evt) {
			evt = (evt) ? evt : ((event) ? event : null);
			var frame = document.getElementById("map_frame");
			mouseX = evt.clientX;
			mouseY = evt.clientY;

			var map_image = document.getElementById("map_image");
			var frame_width = parseInt(frame.style.width);
			var frame_height = parseInt(frame.style.height);
			var map_left = parseInt(map_image.style.left);
			var map_top = parseInt(map_image.style.top);
			var new_map_left = map_left + 0.5*frame_width - convertX(mouseX);
			var new_map_top = map_top + 0.5*frame_height - convertY(mouseY);
			map_image.style.left = new_map_left + "px";
			map_image.style.top = new_map_top + "px";
		}

		function resizeMapFrame() {
			var frame = document.getElementById("map_frame");
			var new_width = 0.7*window.innerWidth;
			var new_height = 0.8*window.innerHeight;
			frame.style.width = 0.7*window.innerWidth + "px";
			frame.style.height = new_height + "px";
		}

		function moveRight() {
			var frame = document.getElementById("map_frame");
			var map_image = document.getElementById("map_image");
			var frame_width = parseInt(frame.style.width);
			var map_left = parseInt(map_image.style.left);
			var new_map_left = map_left + 0.5*frame_width;
			map_image.style.left = new_map_left + "px";
		}

		function moveLeft() {
			var frame = document.getElementById("map_frame");
			var map_image = document.getElementById("map_image");
			var frame_width = parseInt(frame.style.width);
			var map_left = parseInt(map_image.style.left);
			var new_map_left = map_left - 0.5*frame_width;
			map_image.style.left = new_map_left + "px";
		}

		function moveUp() {
			var frame = document.getElementById("map_frame");
			var map_image = document.getElementById("map_image");
			var frame_height = parseInt(frame.style.height);
			var map_top = parseInt(map_image.style.top);
			var new_map_top = map_top - 0.5*frame_height;
			map_image.style.top = new_map_top + "px";
		}

		function moveDown() {
			var frame = document.getElementById("map_frame");
			var map_image = document.getElementById("map_image");
			var frame_height = parseInt(frame.style.height);
			var map_top = parseInt(map_image.style.top);
			var new_map_top = map_top + 0.5*frame_height;
			map_image.style.top = new_map_top + "px";
		}

		function zoomIn() {
			var map_image = document.getElementById("map_image");
			var old_image = getImageObj(map_image.src);
			var old_index = getImageIndex(old_image);
			var new_index = old_index + 1;

			if(new_index < imageArray.length) {
				var new_image = imageArray[new_index];
				map_image.src = new_image.src;

				// Adjust position to keep center point constant.
				var old_left = parseInt(map_image.style.left);
				var old_top = parseInt(map_image.style.top);
				var old_x = getX(old_left);
				var old_y = getY(old_top);
				var new_x = scaleX(old_image, new_image, old_x);
				var new_y = scaleY(old_image, new_image, old_y);
				var new_left = getLeft(new_x);
				var new_top = getTop(new_y);
				map_image.style.left = new_left + "px";
				map_image.style.top = new_top + "px";
			}
		}

		function zoomOut() {
			var map_image = document.getElementById("map_image");
			var old_image = getImageObj(map_image.src);
			var old_index = getImageIndex(old_image);
			var new_index = old_index - 1;

			if(new_index >= 0) {
				var new_image = imageArray[new_index];
				map_image.src = new_image.src;

				// Adjust position to keep center point constant.
				var old_left = parseInt(map_image.style.left);
				var old_top = parseInt(map_image.style.top);
				var old_x = getX(old_left);
				var old_y = getY(old_top);
				var new_x = scaleX(old_image, new_image, old_x);
				var new_y = scaleY(old_image, new_image, old_y);
				var new_left = getLeft(new_x);
				var new_top = getTop(new_y);
				map_image.style.left = new_left + "px";
				map_image.style.top = new_top + "px";
			}
		}

		// Helper functions to calculate positions for zooming

		// x and y represent the position of the frame-centered point of the image relative to the
		// image origin (0,0) => top left corner.
		function getX(left) {
			var frame = document.getElementById("map_frame");
			var frame_width = parseInt(frame.style.width);
			var x = 0.5*frame_width - left;
			return x;
		}

		function getY(top) {
			var frame = document.getElementById("map_frame");
			var frame_height = parseInt(frame.style.height);
			var y = 0.5*frame_height - top;
			return y;
		}

		function getLeft(x) {
			var frame = document.getElementById("map_frame");
			var frame_width = parseInt(frame.style.width);
			var left = 0.5*frame_width - x;
			return left;
		}

		function getTop(y) {
			var frame = document.getElementById("map_frame");
			var frame_height = parseInt(frame.style.height);
			var top = 0.5*frame_height - y;
			return top;
		}

		function scaleX(old_image, new_image, old_x) {
			var new_x = old_x * new_image.width / old_image.width;
			return new_x;
		}

		function scaleY(old_image, new_image, old_y) {
			var new_y = old_y * new_image.height / old_image.height;
			return new_y;
		}

		//Helper functions to access imageArray
		function getImageObj(source) {
			for (var i = 0; i < imageArray.length; i++) {
				if(imageArray[i].src == source) {
					return imageArray[i];
				}
			}
		}

		function getImageIndex(image_object) {
			return imageArray.indexOf(image_object);
		}

		// Helper functions for to calculate positions for doubleclick centering
		function convertX(mouseX) {
			var x = mouseX - border_width - margin_width;
			return x;
		}

		function convertY(mouseY) {
			var y = mouseY - border_width - margin_width;
			return y;
		}

	</script>
</body>
</html>
